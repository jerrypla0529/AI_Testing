<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>èŒé€”æ˜é•œ Â· èŒä¸šå¯¹è¯åŠ©æ‰‹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
          sans-serif;
        background: radial-gradient(circle at top, #111827, #020617);
        color: #e5e7eb;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }

      .app {
        width: 100%;
        max-width: 960px;
        background: rgba(15, 23, 42, 0.96);
        border-radius: 18px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
        padding: 24px 24px 20px;
        backdrop-filter: blur(18px);
      }

      /* æ¬¢è¿å¼¹çª—æ ·å¼ */
      .welcome-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(2, 6, 23, 0.95);
        backdrop-filter: blur(12px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      }

      .welcome-modal.hidden {
        display: none;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .welcome-content {
        background: radial-gradient(circle at top left, #0f172a, #020617);
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        padding: 48px 40px;
        max-width: 520px;
        width: 90%;
        text-align: center;
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
        animation: slideUp 0.4s ease;
      }

      @keyframes slideUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .welcome-logo {
        width: 64px;
        height: 64px;
        border-radius: 18px;
        background: conic-gradient(
          from 160deg,
          #4ade80,
          #22d3ee,
          #6366f1,
          #a855f7,
          #4ade80
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: #020617;
        font-weight: 800;
        font-size: 32px;
        margin: 0 auto 24px;
      }

      .welcome-title {
        font-size: 28px;
        font-weight: 700;
        margin: 0 0 12px;
        background: linear-gradient(135deg, #4ade80, #22d3ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .welcome-subtitle {
        font-size: 15px;
        color: #9ca3af;
        margin-bottom: 36px;
        line-height: 1.6;
      }

      .welcome-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .welcome-btn {
        border: none;
        border-radius: 14px;
        padding: 14px 24px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(55, 65, 81, 0.9);
        color: #e5e7eb;
      }

      .welcome-btn:hover {
        background: rgba(30, 64, 175, 0.3);
        border-color: #22d3ee;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(34, 211, 238, 0.2);
      }

      .welcome-btn.primary {
        background: radial-gradient(circle at top left, #22c55e, #16a34a);
        color: #022c22;
        border: none;
        box-shadow: 0 10px 24px rgba(22, 163, 74, 0.52);
      }

      .welcome-btn.primary:hover {
        box-shadow: 0 18px 30px rgba(22, 163, 74, 0.58);
        filter: brightness(1.05);
      }

      /* æ•™ç¨‹ç•Œé¢æ ·å¼ */
      .tutorial-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(2, 6, 23, 0.95);
        backdrop-filter: blur(12px);
        z-index: 999;
        overflow-y: auto;
        padding: 24px;
        animation: fadeIn 0.3s ease;
      }

      .tutorial-overlay.hidden {
        display: none;
      }

      .tutorial-content {
        max-width: 800px;
        margin: 0 auto;
        background: radial-gradient(circle at top left, #0f172a, #020617);
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        padding: 40px;
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
      }

      .tutorial-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .tutorial-title {
        font-size: 32px;
        font-weight: 700;
        margin: 0 0 12px;
        background: linear-gradient(135deg, #4ade80, #22d3ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .tutorial-section {
        margin-bottom: 32px;
        padding: 24px;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 16px;
        border: 1px solid rgba(55, 65, 81, 0.5);
      }

      .tutorial-section-title {
        font-size: 20px;
        font-weight: 600;
        margin: 0 0 16px;
        color: #22d3ee;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .tutorial-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: linear-gradient(135deg, #4ade80, #22c55e);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #022c22;
        font-weight: 700;
        font-size: 18px;
      }

      .tutorial-text {
        font-size: 15px;
        line-height: 1.8;
        color: #d1d5db;
        margin-bottom: 12px;
      }

      .tutorial-highlight {
        background: rgba(34, 211, 238, 0.15);
        padding: 2px 8px;
        border-radius: 4px;
        color: #22d3ee;
        font-weight: 500;
      }

      .tutorial-close-btn {
        display: block;
        margin: 32px auto 0;
        border: none;
        border-radius: 14px;
        padding: 14px 32px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        background: radial-gradient(circle at top left, #22c55e, #16a34a);
        color: #022c22;
        box-shadow: 0 10px 24px rgba(22, 163, 74, 0.52);
        transition: all 0.2s ease;
      }

      .tutorial-close-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 18px 30px rgba(22, 163, 74, 0.58);
        filter: brightness(1.05);
      }

      .app.hidden {
        display: none;
      }

      .app-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 18px;
      }

      .title-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo {
        width: 32px;
        height: 32px;
        border-radius: 12px;
        background: conic-gradient(
          from 160deg,
          #4ade80,
          #22d3ee,
          #6366f1,
          #a855f7,
          #4ade80
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: #020617;
        font-weight: 800;
        font-size: 18px;
      }

      h1 {
        font-size: 20px;
        margin: 0;
        letter-spacing: 0.04em;
      }

      .subtitle {
        font-size: 12px;
        color: #9ca3af;
      }

      .section-label {
        font-size: 11px;
        text-transform: uppercase;
        color: #9ca3af;
        letter-spacing: 0.12em;
        margin-bottom: 6px;
      }

      .grid {
        display: grid;
        grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.4fr);
        gap: 18px;
        align-items: stretch;
      }

      @media (max-width: 900px) {
        .grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        background: radial-gradient(circle at top left, #020617, #020617);
        border-radius: 14px;
        border: 1px solid rgba(30, 64, 175, 0.5);
        padding: 14px 14px 12px;
      }

      .card + .card {
        border-color: rgba(31, 41, 55, 0.9);
        background: radial-gradient(circle at top left, #020617, #020617);
      }

      label {
        display: block;
        font-size: 12px;
        color: #e5e7eb;
        margin-bottom: 4px;
      }

      label span.hint {
        color: #9ca3af;
        font-size: 11px;
        margin-left: 6px;
      }

      input,
      textarea,
      select {
        width: 100%;
        border-radius: 9px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        padding: 7px 9px;
        font-size: 13px;
        outline: none;
        transition: border-color 0.16s ease, box-shadow 0.16s ease,
          background-color 0.16s ease;
      }

      input:focus,
      textarea:focus,
      select:focus {
        border-color: #22d3ee;
        box-shadow: 0 0 0 1px rgba(34, 211, 238, 0.7);
        background: rgba(15, 23, 42, 0.96);
      }

      input::placeholder,
      textarea::placeholder {
        color: #6b7280;
      }

      textarea {
        resize: vertical;
        min-height: 120px;
        max-height: 260px;
        line-height: 1.5;
      }

      .field-row {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }

      .field-row > div {
        flex: 1;
      }

      .field {
        margin-bottom: 8px;
      }

      .actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 6px;
        gap: 8px;
      }

      .actions-left {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        color: #9ca3af;
      }

      .pill {
        border-radius: 999px;
        border: 1px dashed rgba(55, 65, 81, 0.9);
        padding: 4px 8px;
      }

      .status {
        font-size: 12px;
        min-height: 18px;
      }

      .status span {
        padding: 2px 7px;
        border-radius: 999px;
      }

      .status--idle {
        color: #9ca3af;
      }

      .status--loading span {
        background: rgba(30, 64, 175, 0.2);
        color: #93c5fd;
      }

      .status--error span {
        background: rgba(127, 29, 29, 0.25);
        color: #fecaca;
      }

      .status--success span {
        background: rgba(22, 101, 52, 0.3);
        color: #bbf7d0;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 8px 18px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: radial-gradient(circle at top left, #22c55e, #16a34a);
        color: #022c22;
        box-shadow: 0 10px 24px rgba(22, 163, 74, 0.52);
        transition: transform 0.09s ease, box-shadow 0.09s ease,
          filter 0.09s ease, opacity 0.09s ease;
        white-space: nowrap;
      }

      button:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 18px 30px rgba(22, 163, 74, 0.58);
        filter: brightness(1.03);
      }

      button:active:not(:disabled) {
        transform: translateY(0);
        box-shadow: 0 10px 18px rgba(22, 163, 74, 0.5);
        filter: brightness(0.98);
      }

      button:disabled {
        opacity: 0.55;
        cursor: default;
        box-shadow: none;
      }

      button.secondary {
        background: transparent;
        color: #9ca3af;
        box-shadow: none;
        border-radius: 999px;
        border: 1px dashed rgba(75, 85, 99, 0.95);
        padding: 6px 11px;
        font-size: 11px;
      }

      button.secondary:hover {
        background: rgba(15, 23, 42, 0.75);
        transform: none;
        box-shadow: none;
      }

      .response-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }

      .response-meta {
        font-size: 11px;
        color: #9ca3af;
      }

      .response-box {
        border-radius: 10px;
        border: 1px solid rgba(55, 65, 81, 0.95);
        background: radial-gradient(circle at top, #020617, #020617);
        padding: 10px 10px 9px;
        min-height: 160px;
        font-size: 13px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .response-placeholder {
        color: #6b7280;
      }

      .footer {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid rgba(31, 41, 55, 0.9);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        color: #6b7280;
      }

      .footer a {
        color: #93c5fd;
        text-decoration: none;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }

      /* èŠå¤©è¾“å…¥æ¡†å†…çš„æ–‡ä»¶æŒ‰é’®æ ·å¼ */
      .chat-input-container {
        border-radius: 999px;
        border: 1px solid rgba(55, 65, 81, 0.95);
        padding: 4px 6px 4px 10px;
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(15, 23, 42, 0.9);
      }

      .file-btn-in-chat {
        background: transparent;
        color: #9ca3af;
        box-shadow: none;
        border-radius: 999px;
        border: 1px dashed rgba(75, 85, 99, 0.95);
        padding: 6px 12px;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }

      .file-btn-in-chat:hover {
        background: rgba(15, 23, 42, 0.75);
        border-color: #22d3ee;
        color: #22d3ee;
      }

      .file-info-in-chat {
        font-size: 11px;
        color: #9ca3af;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 120px;
      }
    </style>
  </head>
  <body>
    <!-- æ¬¢è¿å¼¹çª— -->
    <div class="welcome-modal" id="welcomeModal">
      <div class="welcome-content">
        <div class="welcome-logo">LL</div>
        <h2 class="welcome-title">æ¬¢è¿ä½¿ç”¨ã€ŒèŒé€”æ˜é•œã€</h2>
        <p class="welcome-subtitle">
          ä¸ºä½ çš„èŒä¸šè§„åˆ’ã€æ±‚èŒé¢è¯•ä¸èŒåœºé—®é¢˜<br />æä¾› AI è§†è§’çš„å‚è€ƒ
        </p>
        <div class="welcome-buttons">
          <button class="welcome-btn primary" id="newUserBtn">
            æˆ‘æ˜¯æ–°æ‰‹
          </button>
          <button class="welcome-btn" id="returnUserBtn">
            æˆ‘æ›¾ç”¨è¿‡ã€ŒèŒé€”æ˜é•œã€
          </button>
        </div>
      </div>
    </div>

    <!-- æ•™ç¨‹ç•Œé¢ -->
    <div class="tutorial-overlay hidden" id="tutorialOverlay">
      <div class="tutorial-content">
        <div class="tutorial-header">
          <h2 class="tutorial-title">ä½¿ç”¨æŒ‡å—</h2>
          <p style="color: #9ca3af; font-size: 15px;">
            å¿«é€Ÿäº†è§£å¦‚ä½•ä½¿ç”¨ã€ŒèŒé€”æ˜é•œã€
          </p>
        </div>

        <div class="tutorial-section">
          <div class="tutorial-section-title">
            <div class="tutorial-icon">1</div>
            <span>é…ç½® API æ¥å£</span>
          </div>
          <p class="tutorial-text">
            åœ¨å·¦ä¾§é…ç½®åŒºåŸŸï¼Œé¦–å…ˆè¾“å…¥ä½ çš„ <span class="tutorial-highlight">æ¥å£åœ°å€ï¼ˆURLï¼‰</span>ï¼Œä¾‹å¦‚ OpenAI çš„æ¥å£åœ°å€ã€‚ç„¶åé€‰æ‹©è¯·æ±‚æ–¹å¼ï¼ˆé€šå¸¸æ˜¯ POSTï¼‰ï¼Œæœ€åè¾“å…¥ä½ çš„ <span class="tutorial-highlight">API Key</span>ã€‚API Key ä¼šä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œåªæœ‰ä½ èƒ½çœ‹åˆ°ã€‚
          </p>
        </div>

        <div class="tutorial-section">
          <div class="tutorial-section-title">
            <div class="tutorial-icon">2</div>
            <span>å¼€å§‹å¯¹è¯</span>
          </div>
          <p class="tutorial-text">
            é…ç½®å®Œæˆåï¼Œåœ¨å³ä¾§èŠå¤©çª—å£ä¸‹æ–¹çš„ <span class="tutorial-highlight">è¾“å…¥æ¡†</span> ä¸­è¾“å…¥ä½ çš„é—®é¢˜æˆ–éœ€æ±‚ã€‚ä½ å¯ä»¥ç›´æ¥è¾“å…¥æ–‡å­—ï¼Œç„¶åç‚¹å‡» <span class="tutorial-highlight">å‘é€</span> æŒ‰é’®æˆ–æŒ‰ <span class="tutorial-highlight">Enter</span> é”®å‘é€æ¶ˆæ¯ã€‚æŒ‰ <span class="tutorial-highlight">Shift + Enter</span> å¯ä»¥æ¢è¡Œã€‚
          </p>
        </div>

        <div class="tutorial-section">
          <div class="tutorial-section-title">
            <div class="tutorial-icon">3</div>
            <span>ä¸Šä¼ æ–‡ä»¶</span>
          </div>
          <p class="tutorial-text">
            å¦‚æœéœ€è¦ä¸Šä¼ æ–‡ä»¶ï¼ˆå¦‚ç®€å†ã€æ–‡æ¡£ç­‰ï¼‰ï¼Œå¯ä»¥åœ¨èŠå¤©è¾“å…¥æ¡†å†…æ‰¾åˆ° <span class="tutorial-highlight">ğŸ“ é€‰æ‹©æ–‡ä»¶</span> æŒ‰é’®ã€‚ç‚¹å‡»è¯¥æŒ‰é’®é€‰æ‹©æ–‡ä»¶åï¼Œæ–‡ä»¶å†…å®¹ä¼šä½œä¸ºä¸Šä¸‹æ–‡é™„åŠ åˆ°ä½ çš„æ¶ˆæ¯ä¸­ä¸€èµ·å‘é€ç»™ AIã€‚æ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªæ–‡ä»¶ã€‚
          </p>
        </div>

        <div class="tutorial-section">
          <div class="tutorial-section-title">
            <div class="tutorial-icon">4</div>
            <span>æŸ¥çœ‹å›å¤</span>
          </div>
          <p class="tutorial-text">
            AI çš„å›å¤ä¼šæ˜¾ç¤ºåœ¨èŠå¤©çª—å£ä¸­ï¼Œä½ å¯ä»¥ç»§ç»­æé—®è¿›è¡Œå¤šè½®å¯¹è¯ã€‚å¯¹è¯ä¼šä¿æŒä¸Šä¸‹æ–‡ï¼ŒAI èƒ½å¤Ÿç†è§£ä¹‹å‰çš„å¯¹è¯å†…å®¹ã€‚å¦‚æœéœ€è¦å¼€å§‹æ–°çš„å¯¹è¯ï¼Œå¯ä»¥æ¸…ç©ºèŠå¤©è®°å½•ã€‚
          </p>
        </div>

        <button class="tutorial-close-btn" id="tutorialCloseBtn">
          å¼€å§‹ä½¿ç”¨
        </button>
      </div>
    </div>

    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <main class="app hidden" id="mainApp">
      <header class="app-header">
        <div class="title-group">
          <div class="logo">LL</div>
          <div>
            <h1>èŒé€”æ˜é•œ Â· èŒä¸šå¯¹è¯åŠ©æ‰‹</h1>
            <div class="subtitle">ä¸ºä½ çš„èŒä¸šè§„åˆ’ã€æ±‚èŒé¢è¯•ä¸èŒåœºé—®é¢˜æä¾› AI è§†è§’çš„å‚è€ƒ</div>
          </div>
        </div>
      </header>

      <section>
        <div class="section-label">åŸºç¡€è®¾ç½® & å¯¹è¯</div>
        <div class="grid">
          <!-- å·¦ä¾§ï¼šä¸€æ¬¡æ€§é…ç½®åŒºåŸŸ -->
          <div class="card" style="align-self: flex-start;">
            <div class="field">
              <label for="endpoint">
                æ¥å£åœ°å€ï¼ˆURLï¼‰
                <span class="hint">ä¾‹å¦‚ï¼šhttps://api.openai.com/v1/chat/completions</span>
              </label>
              <input
                id="endpoint"
                type="text"
                placeholder="è¾“å…¥ä½ çš„ LLM Agent æ¥å£åœ°å€"
                value="https://api.openai.com/v1/chat/completions"
              />
            </div>

            <div class="field-row">
              <div class="field">
                <label for="method">è¯·æ±‚æ–¹å¼</label>
                <select id="method">
                  <option value="POST">POST</option>
                  <option value="GET">GET</option>
                </select>
              </div>
              <div class="field">
                <label for="apiKey">
                  API Key
                  <span class="hint">æœ¬æœºæµè§ˆå™¨æœ¬åœ°ä¿å­˜ï¼Œä»…ä½ è‡ªå·±å¯è§</span>
                </label>
                <input
                  id="apiKey"
                  type="password"
                  placeholder="åœ¨æ­¤è¾“å…¥ä¸€æ¬¡ OpenAI API Keyï¼Œä¹‹åè‡ªåŠ¨è®°ä½"
                />
              </div>
            </div>

            <div class="actions">
              <div class="actions-left">
                <div class="pill mono" id="methodPreview">
                  fetch(url, { method: "POST" })
                </div>
              </div>
            </div>
            <div class="status status--idle" id="statusText"></div>
          </div>

          <!-- å³ä¾§ï¼šèŠå¤©å¯¹è¯åŒºåŸŸ -->
          <div
            class="card"
            style="
              display: flex;
              flex-direction: column;
              gap: 8px;
              background: radial-gradient(circle at top, #020617, #020617);
            "
          >
            <div class="response-header">
              <div class="section-label" style="margin-bottom: 0">å¯¹è¯çª—å£</div>
              <div class="response-meta mono" id="responseMeta">
                æ–°ä¼šè¯ Â· OpenAI Chat Completions
              </div>
            </div>
            <div
              id="chatHistory"
              style="
                flex: 1;
                min-height: 260px;
                max-height: 460px;
                overflow-y: auto;
                border-radius: 10px;
                border: 1px solid rgba(55, 65, 81, 0.95);
                background: radial-gradient(circle at top, #020617, #020617);
                padding: 10px;
                display: flex;
                flex-direction: column;
                gap: 8px;
              "
            >
              <div
                style="
                  font-size: 12px;
                  color: #6b7280;
                  text-align: center;
                  padding: 8px 0;
                "
              >
                æ¬¢è¿æ¥åˆ°ã€ŒèŒé€”æ˜é•œã€ï¼šåœ¨è¿™é‡Œå’Œä½ çš„èŒä¸šé¡¾é—® AI è¿›è¡Œå¤šè½®å¯¹è¯ã€‚å·¦ä¾§é…ç½®å¥½ OpenAI
                æ¥å£å’Œ API Key åï¼Œä»ä¸‹æ–¹è¾“å…¥æ¡†å¼€å§‹äº¤æµã€‚
              </div>
            </div>
            <div class="chat-input-container">
              <button
                type="button"
                id="fileBtnInChat"
                class="file-btn-in-chat"
                title="é€‰æ‹©æ–‡ä»¶"
              >
                ğŸ“ é€‰æ‹©æ–‡ä»¶
              </button>
              <input
                id="fileInput"
                type="file"
                multiple
                style="display: none;"
              />
              <span id="fileInfoInChat" class="file-info-in-chat">
                æœªé€‰æ‹©æ–‡ä»¶
              </span>
              <input
                id="prompt"
                type="text"
                placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ æƒ³è¯´çš„è¯ï¼ŒæŒ‰ Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ"
                style="
                  border: none;
                  outline: none;
                  background: transparent;
                  font-size: 13px;
                  color: #e5e7eb;
                  flex: 1;
                "
              />
              <button
                type="button"
                id="sendBtn"
                style="padding-inline: 14px; font-size: 12px;"
              >
                <span id="sendBtnLabel">å‘é€</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <footer class="footer">
        <span>
          é»˜è®¤å®ç°å‡è®¾ä½ çš„æ¥å£ä¸º OpenAI Chat Completionsï¼ˆæˆ–å…¼å®¹æ¥å£ï¼‰ï¼›ä½ å¯ä»¥ç›´æ¥åœ¨
          <span class="mono">é¡µé¢åº•éƒ¨çš„ JavaScript</span> ä¸­è‡ªå®šä¹‰è¯·æ±‚ä½“å’Œè§£ææ–¹å¼ã€‚
        </span>
      </footer>
    </main>

    <script>
      const endpointInput = document.getElementById("endpoint");
      const methodSelect = document.getElementById("method");
      const apiKeyInput = document.getElementById("apiKey");
      const promptInput = document.getElementById("prompt");
      const sendBtn = document.getElementById("sendBtn");
      const sendBtnLabel = document.getElementById("sendBtnLabel");
      const statusText = document.getElementById("statusText");
      const responseMeta = document.getElementById("responseMeta");
      const methodPreview = document.getElementById("methodPreview");
      const fileInput = document.getElementById("fileInput");
      const fileInfoInChat = document.getElementById("fileInfoInChat");
      const fileBtnInChat = document.getElementById("fileBtnInChat");
      const chatHistoryEl = document.getElementById("chatHistory");
      const welcomeModal = document.getElementById("welcomeModal");
      const tutorialOverlay = document.getElementById("tutorialOverlay");
      const newUserBtn = document.getElementById("newUserBtn");
      const returnUserBtn = document.getElementById("returnUserBtn");
      const tutorialCloseBtn = document.getElementById("tutorialCloseBtn");
      const mainApp = document.getElementById("mainApp");

      const STORAGE_KEY_API = "llm_demo_openai_api_key";
      const STORAGE_KEY_WELCOME_SHOWN = "llm_demo_welcome_shown";

      let messages = [];

      // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡æ¬¢è¿ç•Œé¢
      const welcomeShown = localStorage.getItem(STORAGE_KEY_WELCOME_SHOWN);
      if (welcomeShown === "true") {
        welcomeModal.classList.add("hidden");
        mainApp.classList.remove("hidden");
      }

      // æ–°æ‰‹æŒ‰é’® - æ˜¾ç¤ºæ•™ç¨‹
      newUserBtn.addEventListener("click", () => {
        welcomeModal.classList.add("hidden");
        tutorialOverlay.classList.remove("hidden");
      });

      // è€ç”¨æˆ·æŒ‰é’® - ç›´æ¥è¿›å…¥ä¸»ç•Œé¢
      returnUserBtn.addEventListener("click", () => {
        welcomeModal.classList.add("hidden");
        mainApp.classList.remove("hidden");
        localStorage.setItem(STORAGE_KEY_WELCOME_SHOWN, "true");
      });

      // å…³é—­æ•™ç¨‹ï¼Œè¿›å…¥ä¸»ç•Œé¢
      tutorialCloseBtn.addEventListener("click", () => {
        tutorialOverlay.classList.add("hidden");
        mainApp.classList.remove("hidden");
        localStorage.setItem(STORAGE_KEY_WELCOME_SHOWN, "true");
      });

      function setStatus(type, text) {
        statusText.className = "status status--" + type;
        statusText.innerHTML = text
          ? "<span>" + text + "</span>"
          : "<span>&nbsp;</span>";
      }

      function setLoading(loading) {
        sendBtn.disabled = loading;
        sendBtnLabel.textContent = loading ? "è°ƒç”¨ä¸­â€¦" : "å‘é€";
      }

      function appendMessage(role, content) {
        const wrap = document.createElement("div");
        wrap.style.display = "flex";
        wrap.style.marginBottom = "2px";
        wrap.style.justifyContent = role === "user" ? "flex-end" : "flex-start";

        const bubble = document.createElement("div");
        bubble.style.maxWidth = "80%";
        bubble.style.padding = "8px 10px";
        bubble.style.borderRadius =
          role === "user" ? "16px 16px 4px 16px" : "16px 16px 16px 4px";
        bubble.style.fontSize = "13px";
        bubble.style.lineHeight = "1.6";
        bubble.style.whiteSpace = "pre-wrap";
        bubble.style.wordWrap = "break-word";

        if (role === "user") {
          bubble.style.background =
            "linear-gradient(135deg, #4ade80, #22c55e, #16a34a)";
          bubble.style.color = "#022c22";
        } else {
          bubble.style.background = "rgba(15,23,42,0.95)";
          bubble.style.border = "1px solid rgba(55,65,81,0.9)";
          bubble.style.color = "#e5e7eb";
        }

        bubble.textContent = content;
        wrap.appendChild(bubble);
        chatHistoryEl.appendChild(wrap);

        chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
      }

      function resetConversation() {
        messages = [];
        chatHistoryEl.innerHTML = `
          <div
            style="
              font-size: 12px;
              color: #6b7280;
              text-align: center;
              padding: 8px 0;
            "
          >
            è¿™æ˜¯ä¸€ä¸ªæ”¯æŒä¸Šä¸‹æ–‡çš„ ChatGPT å¯¹è¯çª—å£ã€‚å·¦ä¾§é…ç½®å¥½ API å’Œæ¨¡å‹åï¼Œåœ¨ä¸‹æ–¹è¾“å…¥æ¡†å¼€å§‹èŠå¤©ã€‚
          </div>
        `;
        responseMeta.textContent = "æ–°ä¼šè¯";
      }

      function updateMethodPreview() {
        const method = methodSelect.value || "POST";
        methodPreview.textContent = 'fetch(url, { method: "' + method + '" })';
      }

      methodSelect.addEventListener("change", updateMethodPreview);
      updateMethodPreview();

      // è¯»å–æœ¬åœ°ä¿å­˜çš„ API Keyï¼ˆä»…ä¿å­˜åœ¨å½“å‰æµè§ˆå™¨ï¼‰
      try {
        const savedKey = localStorage.getItem(STORAGE_KEY_API);
        if (savedKey) {
          apiKeyInput.value = savedKey;
        }
      } catch (e) {
        console.warn("æ— æ³•è¯»å–æœ¬åœ° API Keyï¼š", e);
      }

      apiKeyInput.addEventListener("change", () => {
        const key = apiKeyInput.value.trim();
        try {
          if (key) {
            localStorage.setItem(STORAGE_KEY_API, key);
          } else {
            localStorage.removeItem(STORAGE_KEY_API);
          }
        } catch (e) {
          console.warn("æ— æ³•å†™å…¥æœ¬åœ° API Keyï¼š", e);
        }
      });

      // èŠå¤©æ¡†å†…çš„æ–‡ä»¶æŒ‰é’®
      fileBtnInChat.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", () => {
        const files = Array.from(fileInput.files || []);
        if (!files.length) {
          fileInfoInChat.textContent = "æœªé€‰æ‹©æ–‡ä»¶";
          return;
        }
        if (files.length === 1) {
          fileInfoInChat.textContent = files[0].name;
        } else {
          fileInfoInChat.textContent = files.length + " ä¸ªæ–‡ä»¶";
        }
      });

      function readFileAsText(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result || "");
          reader.onerror = reject;
          reader.readAsText(file);
        });
      }

      function formatJSON(obj) {
        try {
          return JSON.stringify(obj, null, 2);
        } catch (e) {
          return String(obj);
        }
      }

      function extractLLMText(json) {
        try {
          if (
            json &&
            json.choices &&
            Array.isArray(json.choices) &&
            json.choices[0]
          ) {
            const choice = json.choices[0];
            if (choice.message && typeof choice.message.content === "string") {
              return choice.message.content;
            }
            if (typeof choice.text === "string") {
              return choice.text;
            }
          }
        } catch (e) {
          // ignore
        }
        return null;
      }

      async function callLLM() {
        const endpoint = (endpointInput.value || "").trim();
        const method = (methodSelect.value || "POST").toUpperCase();
        const apiKey = apiKeyInput.value.trim();
        let prompt = (promptInput.value || "").trim();

        if (!endpoint) {
          setStatus("error", "è¯·å…ˆè¾“å…¥æ¥å£åœ°å€ï¼ˆURLï¼‰");
          endpointInput.focus();
          return;
        }

        let url;
        try {
          url = new URL(endpoint);
        } catch {
          setStatus("error", "æ¥å£åœ°å€ä¸æ˜¯åˆæ³•çš„ URLï¼Œè¯·æ£€æŸ¥æ ¼å¼");
          return;
        }

        const headers = {
          "Content-Type": "application/json",
        };
        if (apiKey) {
          headers["Authorization"] = "Bearer " + apiKey;
        }

        // è¯»å–é€‰ä¸­çš„æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä½œä¸ºé™„åŠ ä¸Šä¸‹æ–‡å‘é€ç»™ LLM
        const files = Array.from(fileInput.files || []);
        let attachments = [];
        if (files.length) {
          try {
            const contents = await Promise.all(
              files.map((f) => readFileAsText(f))
            );
            attachments = files.map((f, i) => ({
              name: f.name,
              size: f.size,
              type: f.type,
              content: contents[i],
            }));

            // åŒæ—¶æŠŠæ–‡ä»¶å†…å®¹ç®€å•åœ°é™„åŠ åˆ° prompt æœ«å°¾
            // å¦‚ä¸éœ€è¦ï¼Œå¯åˆ é™¤è¿™ä¸€æ®µæ‹¼æ¥ï¼Œåªä¿ç•™ attachments å­—æ®µ
            const fileText =
              attachments
                .map(
                  (a) =>
                    `\n[æ–‡ä»¶: ${a.name} | size=${a.size} bytes]\n${a.content}`
                )
                .join("\n") || "";
            if (fileText) {
              prompt =
                (prompt ? prompt + "\n\n" : "") +
                "[é™„åŠ æ–‡ä»¶å†…å®¹å¼€å§‹]\n" +
                fileText +
                "\n[é™„åŠ æ–‡ä»¶å†…å®¹ç»“æŸ]";
            }
          } catch (e) {
            console.warn("è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œä»…å‘é€æ–‡æœ¬ promptï¼š", e);
          }
        }

        if (!prompt) {
          setStatus("error", "è¯·è¾“å…¥è¦å‘é€çš„å†…å®¹");
          promptInput.focus();
          return;
        }

        const userMessage = { role: "user", content: prompt };
        messages.push(userMessage);
        appendMessage("user", prompt);

        setLoading(true);
        setStatus("loading", "æ­£åœ¨è°ƒç”¨ LLM æ¥å£â€¦");
        responseMeta.textContent = "è¯·æ±‚å‘é€ä¸­â€¦";
        promptInput.value = "";

        // é’ˆå¯¹ OpenAI Chat Completions çš„é»˜è®¤è¯·æ±‚ä½“
        // å¦‚æœä½ ç”¨çš„æ˜¯å…¼å®¹ OpenAI åè®®çš„æœåŠ¡ï¼Œåªéœ€æ”¹ model åç§°å³å¯
        const body = {
          model: "gpt-4.1-mini",
          messages,
          temperature: 0.7,
          // å¦‚æœä½ åœ¨è‡ªå·±åç«¯è½¬å‘ï¼Œå†æ ¹æ®éœ€è¦è‡ªè¡Œå¤„ç† attachments
          // è¿™é‡Œä¸ç›´æ¥ä¼ ç»™ OpenAIï¼Œé¿å…å‡ºç°ä¸å…¼å®¹å­—æ®µ
        };

        // å¦‚æœä½ çš„ API ä¸æ˜¯ OpenAI å…¼å®¹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ”¹é€ ä¸Šé¢ body çš„ç»“æ„

        try {
          const start = performance.now();
          const res = await fetch(url.toString(), {
            method,
            headers,
            body: method === "GET" ? undefined : JSON.stringify(body),
          });

          const timeMs = performance.now() - start;

          let text;
          let json;
          const raw = await res.text();

          try {
            json = JSON.parse(raw);
          } catch {
            // ä¸æ˜¯ JSONï¼Œå½“ä½œçº¯æ–‡æœ¬
            text = raw;
          }

          if (!res.ok) {
            setStatus(
              "error",
              "HTTP " + res.status + " è°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ¥å£å’Œå‚æ•°"
            );
          } else {
            setStatus("success", "è°ƒç”¨æˆåŠŸ");
          }

          let llmText = null;
          if (json != null) {
            llmText = extractLLMText(json);
          }
          if (!llmText && text) {
            llmText = text;
          }
          if (!llmText) {
            llmText = "(æ¨¡å‹æ²¡æœ‰è¿”å›å†…å®¹)";
          }

          const assistantMessage = { role: "assistant", content: llmText };
          messages.push(assistantMessage);
          appendMessage("assistant", llmText);

          responseMeta.textContent =
            "HTTP " +
            res.status +
            " Â· " +
            method +
            " Â· " +
            timeMs.toFixed(0) +
            " ms";
        } catch (err) {
          console.error(err);
          setStatus(
            "error",
            "è¯·æ±‚å¼‚å¸¸ï¼š" + (err && err.message ? err.message : String(err))
          );
          responseMeta.textContent = "è¯·æ±‚å¤±è´¥";
        } finally {
          setLoading(false);
        }
      }

      sendBtn.addEventListener("click", () => {
        callLLM();
      });

      promptInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          callLLM();
        }
      });
    </script>
  </body>
</html>
  </body>
</html>

